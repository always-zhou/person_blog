<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单Learning测试</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 min-h-screen p-8">
    <div id="root"></div>
    
    <!-- 加载必要的脚本 -->
    <script src="../src/js/config.js"></script>
    <script src="../src/js/cloudflare-kv-manager.js"></script>
    <script src="../src/js/api-client.js"></script>
    <script src="../src/js/blog-manager.js"></script>
    <script src="../src/js/blog-manager-kv.js"></script>
    <script src="../src/js/hybrid-blog-manager.js"></script>
    
    <script type="text/babel">
        function SimpleLearningTest() {
            const [status, setStatus] = React.useState('初始化中...');
            const [posts, setPosts] = React.useState([]);
            const [error, setError] = React.useState(null);
            
            React.useEffect(() => {
                testDataLoading();
            }, []);
            
            const testDataLoading = async () => {
                try {
                    setStatus('创建BlogManager实例...');
                    const blogManager = new HybridBlogManager();
                    
                    setStatus('初始化BlogManager...');
                    await blogManager.initialize();
                    
                    setStatus('获取存储信息...');
                    const storageInfo = blogManager.getStorageInfo();
                    console.log('存储信息:', storageInfo);
                    
                    setStatus('加载学习文章...');
                    const learningPosts = await blogManager.getPosts('学习');
                    console.log('学习文章:', learningPosts);
                    
                    setPosts(learningPosts);
                    setStatus(`成功加载 ${learningPosts.length} 篇学习文章`);
                    
                } catch (err) {
                    console.error('测试失败:', err);
                    setError(err.message);
                    setStatus('测试失败');
                }
            };
            
            const handlePostClick = (postId) => {
                alert(`点击了文章: ${postId}`);
                console.log('点击了文章:', postId);
            };
            
            return (
                <div className="max-w-4xl mx-auto">
                    <h1 className="text-3xl font-bold text-white mb-8 text-center">
                        简单Learning数据测试
                    </h1>
                    
                    <div className="bg-white/10 rounded-lg p-6 mb-6">
                        <h2 className="text-xl font-bold text-white mb-4">测试状态</h2>
                        <p className="text-white/80">状态: {status}</p>
                        {error && (
                            <p className="text-red-300 mt-2">错误: {error}</p>
                        )}
                    </div>
                    
                    {posts.length > 0 && (
                        <div className="bg-white/10 rounded-lg p-6">
                            <h2 className="text-xl font-bold text-white mb-4">文章列表 ({posts.length}篇)</h2>
                            <div className="space-y-4">
                                {posts.map((post, index) => (
                                    <div 
                                        key={post.id}
                                        className="bg-white/20 rounded-lg p-4 cursor-pointer hover:bg-white/30 transition-colors"
                                        onClick={() => handlePostClick(post.id)}
                                    >
                                        <h3 className="text-lg font-bold text-white mb-2">
                                            {index + 1}. {post.title}
                                        </h3>
                                        <p className="text-white/70 text-sm mb-2">
                                            ID: {post.id} | 分类: {post.category}
                                        </p>
                                        <p className="text-white/80">
                                            {post.summary}
                                        </p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    
                    <div className="mt-6 text-center">
                        <button 
                            onClick={testDataLoading}
                            className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                            重新测试
                        </button>
                    </div>
                </div>
            );
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SimpleLearningTest />);
    </script>
</body>
</html>