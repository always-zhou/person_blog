<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»¼åˆè¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .button-group {
            margin: 15px 0;
        }
        .button-group button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .device-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .device-card {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .device-card h3 {
            margin-top: 0;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç»¼åˆè¯Šæ–­å·¥å…·</h1>
        <p>è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©è¯Šæ–­æ•°æ®åŒæ­¥å’Œæ–‡ç« æŸ¥çœ‹é—®é¢˜</p>
        
        <!-- è®¾å¤‡ä¿¡æ¯ -->
        <div class="section">
            <h2>ğŸ“± è®¾å¤‡ä¿¡æ¯</h2>
            <div class="device-info" id="device-info"></div>
        </div>
        
        <!-- é…ç½®æ£€æŸ¥ -->
        <div class="section">
            <h2>âš™ï¸ é…ç½®æ£€æŸ¥</h2>
            <div class="button-group">
                <button class="btn-primary" onclick="checkConfiguration()">æ£€æŸ¥é…ç½®</button>
            </div>
            <div id="config-result" class="result"></div>
        </div>
        
        <!-- å­˜å‚¨çŠ¶æ€ -->
        <div class="section">
            <h2>ğŸ’¾ å­˜å‚¨çŠ¶æ€</h2>
            <div class="button-group">
                <button class="btn-info" onclick="checkStorageStatus()">æ£€æŸ¥å­˜å‚¨çŠ¶æ€</button>
                <button class="btn-warning" onclick="compareStorageData()">å¯¹æ¯”å­˜å‚¨æ•°æ®</button>
            </div>
            <div id="storage-result" class="result"></div>
        </div>
        
        <!-- API æµ‹è¯• -->
        <div class="section">
            <h2>ğŸŒ API æµ‹è¯•</h2>
            <div class="button-group">
                <button class="btn-primary" onclick="testAPIHealth()">æµ‹è¯•APIå¥åº·çŠ¶æ€</button>
                <button class="btn-info" onclick="testGetPosts()">æµ‹è¯•è·å–æ–‡ç« åˆ—è¡¨</button>
                <button class="btn-success" onclick="testGetSinglePost()">æµ‹è¯•è·å–å•ç¯‡æ–‡ç« </button>
                <button class="btn-warning" onclick="testCreatePost()">æµ‹è¯•åˆ›å»ºæ–‡ç« </button>
            </div>
            <div id="api-result" class="result"></div>
        </div>
        
        <!-- æ–‡ç« æŸ¥çœ‹æµ‹è¯• -->
        <div class="section">
            <h2>ğŸ“– æ–‡ç« æŸ¥çœ‹æµ‹è¯•</h2>
            <div class="button-group">
                <button class="btn-primary" onclick="testPostViewing()">æµ‹è¯•æ–‡ç« æŸ¥çœ‹åŠŸèƒ½</button>
                <button class="btn-info" onclick="debugPostIDs()">è°ƒè¯•æ–‡ç« IDé—®é¢˜</button>
            </div>
            <div id="post-viewing-result" class="result"></div>
        </div>
        
        <!-- æ•°æ®åŒæ­¥ -->
        <div class="section">
            <h2>ğŸ”„ æ•°æ®åŒæ­¥</h2>
            <div class="button-group">
                <button class="btn-success" onclick="syncLocalToKV()">åŒæ­¥æœ¬åœ°åˆ°äº‘ç«¯</button>
                <button class="btn-success" onclick="syncKVToLocal()">åŒæ­¥äº‘ç«¯åˆ°æœ¬åœ°</button>
                <button class="btn-warning" onclick="forceUseKV()">å¼ºåˆ¶ä½¿ç”¨äº‘ç«¯å­˜å‚¨</button>
                <button class="btn-warning" onclick="forceUseLocal()">å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°å­˜å‚¨</button>
            </div>
            <div id="sync-result" class="result"></div>
        </div>
        
        <!-- ä¿®å¤å·¥å…· -->
        <div class="section">
            <h2>ğŸ”¨ ä¿®å¤å·¥å…·</h2>
            <div class="button-group">
                <button class="btn-success" onclick="fixPostIDs()">ä¿®å¤æ–‡ç« IDæ ¼å¼</button>
                <button class="btn-danger" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                <button class="btn-info" onclick="resetToDefaults()">é‡ç½®ä¸ºé»˜è®¤æ•°æ®</button>
            </div>
            <div id="fix-result" class="result"></div>
        </div>
    </div>
    
    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="../src/js/config.js"></script>
    <script src="../src/js/blog-manager.js"></script>
    <script src="../src/js/cloudflare-kv-manager.js"></script>
    <script src="../src/js/blog-manager-kv.js"></script>
    <script src="../src/js/api-client.js"></script>
    <script src="../src/js/hybrid-blog-manager.js"></script>
    
    <script>
        let hybridManager;
        let localManager;
        let apiClient;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', async function() {
            displayDeviceInfo();
            await initializeManagers();
        });
        
        function displayDeviceInfo() {
            const deviceInfoDiv = document.getElementById('device-info');
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            deviceInfoDiv.innerHTML = `
                <div class="device-card">
                    <h3>è®¾å¤‡ç±»å‹</h3>
                    <p>${isMobile ? 'ğŸ“± ç§»åŠ¨è®¾å¤‡' : 'ğŸ’» æ¡Œé¢è®¾å¤‡'}</p>
                </div>
                <div class="device-card">
                    <h3>æµè§ˆå™¨ä¿¡æ¯</h3>
                    <p>${navigator.userAgent}</p>
                </div>
                <div class="device-card">
                    <h3>ç½‘ç»œä¿¡æ¯</h3>
                    <p>åŸŸå: ${window.location.hostname}</p>
                    <p>åè®®: ${window.location.protocol}</p>
                    <p>ç«¯å£: ${window.location.port || 'é»˜è®¤'}</p>
                </div>
                <div class="device-card">
                    <h3>å­˜å‚¨æ”¯æŒ</h3>
                    <p>localStorage: ${typeof(Storage) !== 'undefined' ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</p>
                    <p>sessionStorage: ${typeof(sessionStorage) !== 'undefined' ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</p>
                </div>
            `;
        }
        
        async function initializeManagers() {
            try {
                hybridManager = new HybridBlogManager();
                localManager = new BlogManager();
                apiClient = new APIClient();
                
                await hybridManager.initialize();
                console.log('ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('åˆå§‹åŒ–ç®¡ç†å™¨å¤±è´¥:', error);
            }
        }
        
        function checkConfiguration() {
            const resultDiv = document.getElementById('config-result');
            const config = window.CONFIG || {};
            const blogConfig = window.BLOG_CONFIG || {};
            
            resultDiv.className = 'result info';
            resultDiv.textContent = `é…ç½®æ£€æŸ¥ç»“æœ:

window.CONFIG: ${JSON.stringify(config, null, 2)}

window.BLOG_CONFIG: ${JSON.stringify(blogConfig, null, 2)}

window.WORKER_URL: ${window.WORKER_URL || 'æœªè®¾ç½®'}

é…ç½®çŠ¶æ€: ${config.WORKER_URL ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®'}`;
        }
        
        async function checkStorageStatus() {
            const resultDiv = document.getElementById('storage-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æ£€æŸ¥å­˜å‚¨çŠ¶æ€...';
            
            try {
                const storageInfo = hybridManager.getStorageInfo();
                const apiInfo = apiClient.getAPIInfo();
                
                let statusClass = 'info';
                let statusText = '';
                
                if (storageInfo.type.includes('KV')) {
                    statusClass = 'success';
                    statusText = 'âœ… ä½¿ç”¨äº‘ç«¯KVå­˜å‚¨ - æ•°æ®ä¼šåŒæ­¥';
                } else {
                    statusClass = 'warning';
                    statusText = 'âš ï¸ ä½¿ç”¨æœ¬åœ°å­˜å‚¨ - æ•°æ®ä¸ä¼šåŒæ­¥';
                }
                
                resultDiv.className = `result ${statusClass}`;
                resultDiv.textContent = `${statusText}

è¯¦ç»†ä¿¡æ¯:
å­˜å‚¨ç±»å‹: ${storageInfo.type}
åˆå§‹åŒ–çŠ¶æ€: ${storageInfo.initialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}
APIåŸºç¡€URL: ${apiInfo.baseURL || 'æœªé…ç½®'}
ç¯å¢ƒ: ${apiInfo.environment}

APIå¥åº·æ£€æŸ¥: ${await apiClient.checkAPIHealth() ? 'âœ… å¥åº·' : 'âŒ ä¸å¥åº·'}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `æ£€æŸ¥å¤±è´¥: ${error.message}`;
            }
        }
        
        async function compareStorageData() {
            const resultDiv = document.getElementById('storage-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨å¯¹æ¯”å­˜å‚¨æ•°æ®...';
            
            try {
                // è·å–æœ¬åœ°æ•°æ®
                const localPosts = localManager.getPosts();
                
                // è·å–KVæ•°æ®
                let kvPosts = [];
                try {
                    kvPosts = await apiClient.getPosts() || [];
                } catch (error) {
                    console.warn('æ— æ³•è·å–KVæ•°æ®:', error);
                }
                
                resultDiv.className = 'result info';
                resultDiv.textContent = `æ•°æ®å¯¹æ¯”ç»“æœ:

æœ¬åœ°å­˜å‚¨æ–‡ç« æ•°: ${localPosts.length}
äº‘ç«¯KVæ–‡ç« æ•°: ${kvPosts.length}

æœ¬åœ°æ–‡ç« åˆ—è¡¨:
${JSON.stringify(localPosts.map(p => ({id: p.id, title: p.title, createdAt: p.createdAt})), null, 2)}

äº‘ç«¯æ–‡ç« åˆ—è¡¨:
${JSON.stringify(kvPosts.map(p => ({id: p.id, title: p.title, createdAt: p.createdAt})), null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `å¯¹æ¯”å¤±è´¥: ${error.message}`;
            }
        }
        
        async function testAPIHealth() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•APIå¥åº·çŠ¶æ€...';
            
            try {
                const isHealthy = await apiClient.checkAPIHealth();
                const apiInfo = apiClient.getAPIInfo();
                
                resultDiv.className = `result ${isHealthy ? 'success' : 'error'}`;
                resultDiv.textContent = `APIå¥åº·æ£€æŸ¥: ${isHealthy ? 'âœ… å¥åº·' : 'âŒ ä¸å¥åº·'}

APIä¿¡æ¯:
${JSON.stringify(apiInfo, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `APIæµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        }
        
        async function testGetPosts() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•è·å–æ–‡ç« åˆ—è¡¨...';
            
            try {
                const posts = await apiClient.getPosts();
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `âœ… è·å–æ–‡ç« åˆ—è¡¨æˆåŠŸï¼

æ–‡ç« æ•°é‡: ${posts ? posts.length : 0}

æ–‡ç« åˆ—è¡¨:
${JSON.stringify(posts, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `è·å–æ–‡ç« åˆ—è¡¨å¤±è´¥: ${error.message}`;
            }
        }
        
        async function testGetSinglePost() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•è·å–å•ç¯‡æ–‡ç« ...';
            
            try {
                // å…ˆè·å–æ–‡ç« åˆ—è¡¨ï¼Œç„¶åæµ‹è¯•è·å–ç¬¬ä¸€ç¯‡æ–‡ç« 
                const posts = await apiClient.getPosts();
                if (!posts || posts.length === 0) {
                    resultDiv.className = 'result warning';
                    resultDiv.textContent = 'âš ï¸ æ²¡æœ‰æ–‡ç« å¯ä¾›æµ‹è¯•';
                    return;
                }
                
                const firstPostId = posts[0].id;
                const post = await apiClient.getPost(firstPostId);
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `âœ… è·å–å•ç¯‡æ–‡ç« æˆåŠŸï¼

æµ‹è¯•æ–‡ç« ID: ${firstPostId}

æ–‡ç« è¯¦æƒ…:
${JSON.stringify(post, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `è·å–å•ç¯‡æ–‡ç« å¤±è´¥: ${error.message}`;
            }
        }
        
        async function testCreatePost() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•åˆ›å»ºæ–‡ç« ...';
            
            try {
                const testPost = {
                    title: `è¯Šæ–­æµ‹è¯•æ–‡ç«  - ${new Date().toLocaleString()}`,
                    content: `è¿™æ˜¯ä¸€ç¯‡ç”¨äºè¯Šæ–­çš„æµ‹è¯•æ–‡ç« ï¼Œåˆ›å»ºæ—¶é—´ï¼š${new Date().toISOString()}`,
                    summary: 'è¯Šæ–­æµ‹è¯•æ–‡ç« ',
                    category: 'æµ‹è¯•',
                    tags: ['è¯Šæ–­', 'æµ‹è¯•']
                };
                
                const result = await apiClient.createPost(testPost);
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `âœ… åˆ›å»ºæ–‡ç« æˆåŠŸï¼

åˆ›å»ºç»“æœ:
${JSON.stringify(result, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `åˆ›å»ºæ–‡ç« å¤±è´¥: ${error.message}`;
            }
        }
        
        async function testPostViewing() {
            const resultDiv = document.getElementById('post-viewing-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•æ–‡ç« æŸ¥çœ‹åŠŸèƒ½...';
            
            try {
                // æµ‹è¯•æ··åˆç®¡ç†å™¨çš„getPostæ–¹æ³•
                const posts = await hybridManager.getPosts();
                if (!posts || posts.length === 0) {
                    resultDiv.className = 'result warning';
                    resultDiv.textContent = 'âš ï¸ æ²¡æœ‰æ–‡ç« å¯ä¾›æµ‹è¯•';
                    return;
                }
                
                const testResults = [];
                
                // æµ‹è¯•å‰3ç¯‡æ–‡ç« 
                for (let i = 0; i < Math.min(3, posts.length); i++) {
                    const post = posts[i];
                    const retrievedPost = await hybridManager.getPost(post.id);
                    
                    testResults.push({
                        originalId: post.id,
                        originalIdType: typeof post.id,
                        title: post.title,
                        retrievedPost: retrievedPost ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥',
                        retrievedTitle: retrievedPost ? retrievedPost.title : 'æ— '
                    });
                }
                
                resultDiv.className = 'result info';
                resultDiv.textContent = `æ–‡ç« æŸ¥çœ‹æµ‹è¯•ç»“æœ:

${JSON.stringify(testResults, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        }
        
        async function debugPostIDs() {
            const resultDiv = document.getElementById('post-viewing-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨è°ƒè¯•æ–‡ç« IDé—®é¢˜...';
            
            try {
                // è·å–æœ¬åœ°å’Œäº‘ç«¯çš„æ–‡ç« 
                const localPosts = localManager.getPosts();
                const kvPosts = await apiClient.getPosts() || [];
                
                const debugInfo = {
                    localPosts: localPosts.map(p => ({ id: p.id, idType: typeof p.id, title: p.title })),
                    kvPosts: kvPosts.map(p => ({ id: p.id, idType: typeof p.id, title: p.title })),
                    localGetPostTest: {},
                    kvGetPostTest: {}
                };
                
                // æµ‹è¯•æœ¬åœ°getPost
                if (localPosts.length > 0) {
                    const firstLocal = localPosts[0];
                    debugInfo.localGetPostTest = {
                        originalId: firstLocal.id,
                        stringId: String(firstLocal.id),
                        intId: parseInt(firstLocal.id),
                        getPostWithOriginal: localManager.getPost(firstLocal.id) ? 'âœ…' : 'âŒ',
                        getPostWithString: localManager.getPost(String(firstLocal.id)) ? 'âœ…' : 'âŒ',
                        getPostWithInt: localManager.getPost(parseInt(firstLocal.id)) ? 'âœ…' : 'âŒ'
                    };
                }
                
                // æµ‹è¯•KV getPost
                if (kvPosts.length > 0) {
                    const firstKV = kvPosts[0];
                    debugInfo.kvGetPostTest = {
                        originalId: firstKV.id,
                        stringId: String(firstKV.id),
                        intId: parseInt(firstKV.id),
                        getPostWithOriginal: await apiClient.getPost(firstKV.id) ? 'âœ…' : 'âŒ',
                        getPostWithString: await apiClient.getPost(String(firstKV.id)) ? 'âœ…' : 'âŒ'
                    };
                }
                
                resultDiv.className = 'result info';
                resultDiv.textContent = `æ–‡ç« IDè°ƒè¯•ä¿¡æ¯:

${JSON.stringify(debugInfo, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `è°ƒè¯•å¤±è´¥: ${error.message}`;
            }
        }
        
        async function syncLocalToKV() {
            const resultDiv = document.getElementById('sync-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨åŒæ­¥æœ¬åœ°æ•°æ®åˆ°äº‘ç«¯...';
            
            try {
                const localPosts = localManager.getPosts();
                let successCount = 0;
                const errors = [];
                
                for (const post of localPosts) {
                    try {
                        await apiClient.createPost(post);
                        successCount++;
                    } catch (error) {
                        errors.push(`${post.title}: ${error.message}`);
                    }
                }
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `âœ… åŒæ­¥å®Œæˆï¼

æˆåŠŸåŒæ­¥: ${successCount}/${localPosts.length} ç¯‡æ–‡ç« 

é”™è¯¯ä¿¡æ¯:
${errors.join('\n')}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `åŒæ­¥å¤±è´¥: ${error.message}`;
            }
        }
        
        async function syncKVToLocal() {
            const resultDiv = document.getElementById('sync-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨åŒæ­¥äº‘ç«¯æ•°æ®åˆ°æœ¬åœ°...';
            
            try {
                const kvPosts = await apiClient.getPosts() || [];
                
                // æ¸…ç©ºæœ¬åœ°æ•°æ®
                localStorage.removeItem('blogPosts');
                localManager.posts = [];
                
                // æ·»åŠ KVæ•°æ®åˆ°æœ¬åœ°
                for (const post of kvPosts) {
                    localManager.addPost(post);
                }
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `âœ… åŒæ­¥å®Œæˆï¼

æˆåŠŸåŒæ­¥ ${kvPosts.length} ç¯‡æ–‡ç« åˆ°æœ¬åœ°å­˜å‚¨`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `åŒæ­¥å¤±è´¥: ${error.message}`;
            }
        }
        
        async function forceUseKV() {
            const resultDiv = document.getElementById('sync-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨å¼ºåˆ¶åˆ‡æ¢åˆ°äº‘ç«¯å­˜å‚¨...';
            
            try {
                hybridManager.useAPI = true;
                await hybridManager.kvManager.initialize();
                
                resultDiv.className = 'result success';
                resultDiv.textContent = 'âœ… å·²å¼ºåˆ¶åˆ‡æ¢åˆ°äº‘ç«¯KVå­˜å‚¨æ¨¡å¼';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `åˆ‡æ¢å¤±è´¥: ${error.message}`;
            }
        }
        
        function forceUseLocal() {
            const resultDiv = document.getElementById('sync-result');
            hybridManager.useAPI = false;
            resultDiv.className = 'result success';
            resultDiv.textContent = 'âœ… å·²å¼ºåˆ¶åˆ‡æ¢åˆ°æœ¬åœ°å­˜å‚¨æ¨¡å¼';
        }
        
        async function fixPostIDs() {
            const resultDiv = document.getElementById('fix-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨ä¿®å¤æ–‡ç« IDæ ¼å¼...';
            
            try {
                // ä¿®å¤æœ¬åœ°å­˜å‚¨çš„IDæ ¼å¼
                const localPosts = localManager.getPosts();
                let fixedCount = 0;
                
                for (const post of localPosts) {
                    if (typeof post.id === 'string') {
                        post.id = parseInt(post.id) || Date.now();
                        fixedCount++;
                    }
                }
                
                if (fixedCount > 0) {
                    localManager.savePosts();
                }
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `âœ… IDæ ¼å¼ä¿®å¤å®Œæˆï¼

ä¿®å¤äº† ${fixedCount} ç¯‡æ–‡ç« çš„IDæ ¼å¼`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `ä¿®å¤å¤±è´¥: ${error.message}`;
            }
        }
        
        async function clearAllData() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }
            
            const resultDiv = document.getElementById('fix-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æ¸…ç©ºæ‰€æœ‰æ•°æ®...';
            
            try {
                // æ¸…ç©ºæœ¬åœ°æ•°æ®
                localStorage.removeItem('blogPosts');
                localManager.posts = [];
                
                // å°è¯•æ¸…ç©ºKVæ•°æ®
                try {
                    const kvPosts = await apiClient.getPosts() || [];
                    for (const post of kvPosts) {
                        await apiClient.deletePost(post.id);
                    }
                } catch (error) {
                    console.warn('æ¸…ç©ºKVæ•°æ®å¤±è´¥:', error);
                }
                
                resultDiv.className = 'result success';
                resultDiv.textContent = 'âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç©º';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `æ¸…ç©ºæ•°æ®å¤±è´¥: ${error.message}`;
            }
        }
        
        function resetToDefaults() {
            const resultDiv = document.getElementById('fix-result');
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨é‡ç½®ä¸ºé»˜è®¤æ•°æ®...';
            
            try {
                // æ¸…ç©ºç°æœ‰æ•°æ®
                localStorage.removeItem('blogPosts');
                
                // é‡æ–°åˆ›å»ºç®¡ç†å™¨ï¼Œè¿™ä¼šåŠ è½½é»˜è®¤æ•°æ®
                localManager = new BlogManager();
                
                resultDiv.className = 'result success';
                resultDiv.textContent = 'âœ… å·²é‡ç½®ä¸ºé»˜è®¤æ•°æ®';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `é‡ç½®å¤±è´¥: ${error.message}`;
            }
        }
    </script>
</body>
</html>