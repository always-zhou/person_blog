<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>删除功能调试</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // PostCard 组件
        function PostCard({ post, onClick, showActions = false, onEdit, onDelete }) {
          const formatDate = (dateString) => {
            return new Date(dateString).toLocaleDateString('zh-CN', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            });
          };

          const getCategoryColor = (category) => {
            const colors = {
              '学习': 'from-blue-500 to-purple-600',
              '健身': 'from-green-500 to-teal-600',
              '生活': 'from-pink-500 to-rose-600',
              '摄影': 'from-yellow-500 to-orange-600'
            };
            return colors[category] || 'from-gray-500 to-gray-600';
          };

          const handleClick = (e) => {
            if (onClick) {
              onClick(e);
            }
          };

          return (
            <div 
              className="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 hover:bg-white/15 transition-all duration-300 transform hover:scale-105 cursor-pointer group"
              onClick={handleClick}
            >
              <div>
                {/* 分类标签 */}
                <div className="flex items-center justify-between mb-4">
                  <span className={`px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r ${getCategoryColor(post.category)} text-white`}>
                    {post.category}
                  </span>
                  <span className="text-white/60 text-sm">{post.readTime}</span>
                </div>

                {/* 标题 */}
                <h3 className="text-xl font-bold text-white mb-3 group-hover:text-purple-300 transition-colors">
                  {post.title}
                </h3>

                {/* 摘要 */}
                <p className="text-white/80 mb-4 line-clamp-3">
                  {post.summary}
                </p>

                {/* 标签 */}
                <div className="flex flex-wrap gap-2 mb-4">
                  {post.tags.slice(0, 3).map(tag => (
                    <span key={tag} className="px-2 py-1 bg-white/20 rounded-md text-xs text-white/90">
                      {tag}
                    </span>
                  ))}
                  {post.tags.length > 3 && (
                    <span className="px-2 py-1 bg-white/20 rounded-md text-xs text-white/70">
                      +{post.tags.length - 3}
                    </span>
                  )}
                </div>

                {/* 日期 */}
                <div className="text-white/60 text-sm">
                  {formatDate(post.createdAt)}
                </div>
              </div>

              {/* 管理操作按钮 */}
              {showActions && (
                <div className="flex gap-2 mt-4 pt-4 border-t border-white/20">
                  <button
                    onClick={(e) => {
                      console.log('编辑按钮被点击');
                      e.stopPropagation();
                      onEdit(post);
                    }}
                    className="flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
                  >
                    编辑
                  </button>
                  <button
                    onClick={(e) => {
                      console.log('删除按钮被点击');
                      e.stopPropagation();
                      console.log('准备显示确认对话框');
                      if (confirm('确定要删除这篇文章吗？')) {
                        console.log('用户确认删除，调用onDelete:', post.id);
                        onDelete(post.id);
                      } else {
                        console.log('用户取消删除');
                      }
                    }}
                    className="flex-1 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm"
                  >
                    删除
                  </button>
                </div>
              )}
            </div>
          );
        }
        
        // 测试应用
        function TestApp() {
            const [posts, setPosts] = useState([
                {
                    id: 'test-1',
                    title: '测试文章1',
                    summary: '这是一篇测试文章的摘要',
                    category: '学习',
                    tags: ['测试', 'JavaScript'],
                    readTime: '5分钟',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'test-2', 
                    title: '测试文章2',
                    summary: '这是另一篇测试文章的摘要',
                    category: '生活',
                    tags: ['测试', '调试'],
                    readTime: '3分钟',
                    createdAt: new Date().toISOString()
                }
            ]);
            
            const handleDeletePost = (postId) => {
                console.log('handleDeletePost 被调用，postId:', postId);
                setPosts(prevPosts => {
                    const newPosts = prevPosts.filter(p => p.id !== postId);
                    console.log('删除后的文章列表:', newPosts);
                    return newPosts;
                });
            };
            
            const handleEditPost = (post) => {
                console.log('handleEditPost 被调用，post:', post);
                alert('编辑功能正常: ' + post.title);
            };
            
            return (
                <div className="container mx-auto px-4 py-8">
                    <h1 className="text-3xl font-bold text-white mb-8">删除功能调试测试</h1>
                    <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                        {posts.map(post => (
                            <PostCard
                                key={post.id}
                                post={post}
                                showActions={true}
                                onEdit={handleEditPost}
                                onDelete={(postId) => {
                                    console.log('onDelete 回调被调用，postId:', postId);
                                    handleDeletePost(postId);
                                }}
                            />
                        ))}
                    </div>
                    {posts.length === 0 && (
                        <div className="text-white text-center mt-8">
                            <p>所有文章已删除！删除功能正常工作。</p>
                        </div>
                    )}
                </div>
            );
        }
        
        // 渲染应用
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TestApp />);
        
        // 全局错误处理
        window.addEventListener('error', function(e) {
            console.error('JavaScript错误:', e.error);
        });
    </script>
</body>
</html>