<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>调试PostCard点击事件</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="../src/js/api-client.js"></script>
    <script src="../src/js/cloudflare-kv-manager.js"></script>
    <script src="../src/js/blog-manager.js"></script>
    <script src="../src/js/blog-manager-kv.js"></script>
    <script src="../src/js/hybrid-blog-manager.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a2e;
            color: white;
        }
        .debug-section {
            background: #16213e;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #0f3460;
        }
        .click-log {
            background: #0f3460;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>PostCard点击事件调试</h1>
    <div id="root"></div>

    <script type="text/babel">
        // 简化的PostCard组件
        function PostCard({ post, onClick, showActions = false, onEdit, onDelete }) {
            const formatDate = (dateString) => {
                return new Date(dateString).toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            };

            const getCategoryColor = (category) => {
                const colors = {
                    '学习': 'from-blue-500 to-purple-600',
                    '健身': 'from-green-500 to-teal-600',
                    '生活': 'from-pink-500 to-rose-600',
                    '摄影': 'from-yellow-500 to-orange-600'
                };
                return colors[category] || 'from-gray-500 to-gray-600';
            };

            return (
                <div 
                    className="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 hover:bg-white/15 transition-all duration-300 transform hover:scale-105 cursor-pointer group"
                    onClick={onClick}
                >
                    <div>
                        {/* 分类标签 */}
                        <div className="flex items-center justify-between mb-4">
                            <span className={`px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r ${getCategoryColor(post.category)} text-white`}>
                                {post.category}
                            </span>
                            <span className="text-white/60 text-sm">{formatDate(post.createdAt)}</span>
                        </div>

                        {/* 标题 */}
                        <h3 className="text-xl font-bold text-white mb-3 group-hover:text-purple-300 transition-colors">
                            {post.title}
                        </h3>

                        {/* 摘要 */}
                        <p className="text-white/80 mb-4 line-clamp-3">
                            {post.content ? post.content.substring(0, 100) + '...' : '暂无内容'}
                        </p>

                        {/* 操作按钮 */}
                        {showActions && (
                            <div className="flex space-x-2 mt-4">
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        onEdit && onEdit();
                                    }}
                                    className="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600"
                                >
                                    编辑
                                </button>
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        onDelete && onDelete();
                                    }}
                                    className="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600"
                                >
                                    删除
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function DebugPostCardClick() {
            const [posts, setPosts] = React.useState([]);
            const [clickLogs, setClickLogs] = React.useState([]);
            const [blogManager] = React.useState(() => new HybridBlogManager());
            const [loading, setLoading] = React.useState(true);

            React.useEffect(() => {
                loadTestData();
            }, []);

            const loadTestData = async () => {
                try {
                    await blogManager.initialize();
                    
                    // 创建测试数据
                    const testPosts = [
                        {
                            id: 'test-learning-1',
                            title: '测试学习文章1',
                            content: '这是一篇测试学习文章',
                            category: '学习',
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 'test-fitness-1',
                            title: '测试健身文章1',
                            content: '这是一篇测试健身文章',
                            category: '健身',
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 'test-life-1',
                            title: '测试生活文章1',
                            content: '这是一篇测试生活文章',
                            category: '生活',
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        },
                        {
                            id: 'test-photography-1',
                            title: '测试摄影文章1',
                            content: '这是一篇测试摄影文章',
                            category: '摄影',
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        }
                    ];
                    
                    setPosts(testPosts);
                    setLoading(false);
                    
                    addLog('测试数据加载完成', 'success');
                } catch (error) {
                    console.error('加载测试数据失败:', error);
                    addLog(`加载失败: ${error.message}`, 'error');
                    setLoading(false);
                }
            };

            const addLog = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                setClickLogs(prev => [...prev, {
                    id: Date.now(),
                    timestamp,
                    message,
                    type
                }]);
            };

            const handlePostClick = (post) => {
                console.log('PostCard点击事件触发:', post);
                addLog(`点击了 ${post.category} 分类的文章: ${post.title}`, 'success');
                alert(`成功点击: ${post.title} (${post.category})`);
            };

            const handleEditPost = (post) => {
                console.log('编辑按钮点击:', post);
                addLog(`编辑按钮点击: ${post.title}`, 'info');
            };

            const handleDeletePost = (postId) => {
                console.log('删除按钮点击:', postId);
                addLog(`删除按钮点击: ${postId}`, 'warning');
            };

            if (loading) {
                return <div>正在加载测试数据...</div>;
            }

            return (
                <div>
                    <div className="debug-section">
                        <h2>点击日志</h2>
                        <div style={{maxHeight: '200px', overflowY: 'auto'}}>
                            {clickLogs.map(log => (
                                <div key={log.id} className="click-log" style={{
                                    borderLeft: `4px solid ${
                                        log.type === 'success' ? '#10b981' :
                                        log.type === 'error' ? '#ef4444' :
                                        log.type === 'warning' ? '#f59e0b' : '#6b7280'
                                    }`
                                }}>
                                    [{log.timestamp}] {log.message}
                                </div>
                            ))}
                        </div>
                        <button 
                            onClick={() => setClickLogs([])} 
                            className="mt-2 px-4 py-2 bg-gray-600 text-white rounded"
                        >
                            清空日志
                        </button>
                    </div>

                    <div className="debug-section">
                        <h2>测试PostCard</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            {posts.map(post => (
                                <div key={post.id} className="border border-gray-600 rounded p-2">
                                    <h3 className="text-lg font-bold mb-2">{post.category} 分类</h3>
                                    <PostCard
                                        post={post}
                                        onClick={() => handlePostClick(post)}
                                        onEdit={() => handleEditPost(post)}
                                        onDelete={() => handleDeletePost(post.id)}
                                        showActions={true}
                                    />
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="debug-section">
                        <h2>手动测试按钮</h2>
                        <div className="space-x-2">
                            {posts.map(post => (
                                <button
                                    key={`btn-${post.id}`}
                                    onClick={() => handlePostClick(post)}
                                    className="px-4 py-2 bg-blue-600 text-white rounded mr-2 mb-2"
                                >
                                    点击 {post.category} 文章
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DebugPostCardClick />);
    </script>
</body>
</html>